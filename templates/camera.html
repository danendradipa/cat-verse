{% extends "base.html" %}

{% block content %}
<section class="pt-20 pb-6">
  <div class="container md:w-[60%]">
    <h1 class="text-4xl font-bold text-center">
      Yuk Identifikasi Ras Kucing Kamu
    </h1>
    <div
    id="tips"
    class="bg-red-50 border border-red-200 rounded-md p-4 mt-8 md:w-[90%] mx-auto"
  >
    <p class="text-sm text-red-800 font-bold flex items-center">
      <svg
        xmlns="http://www.w3.org/2000/svg"
        class="h-5 w-5 mr-2"
        viewBox="0 0 20 20"
        fill="currentColor"
      >
        <path
          fill-rule="evenodd"
          d="M18 10c0 4.418-3.582 8-8 8a8 8 0 110-16c4.418 0 8 3.582 8 8zm-9 4a1 1 0 102 0h-2zm0-8a1 1 0 012 0v4a1 1 0 11-2 0V6z"
          clip-rule="evenodd"
        />
      </svg>
      Fitur kamera masih dalam tahap pengembangan dan belum bisa digunakan
    </p>
  </div>
    <div class="flex justify-between">
      <a href="/classify">
        <button
          class="bg-green-700 hover:bg-green-800 transition-all duration-300 py-3 px-6 rounded-xl text-white mt-5"
        >
          Mode Upload
        </button>
      </a>

      <button
        id="takePhotoBtn"
        class="bg-blue-700 hover:bg-blue-800 transition-all duration-300 py-3 px-6 rounded-xl text-white mt-5"
      >
        Ambil Foto
      </button>
    </div>

    <!-- Tampilan Kamera -->
    <div class="mt-10 text-center" id="cameraContainer">
      <video id="video" width="100%" autoplay></video>
      <canvas id="canvas" style="display: none"></canvas>
    </div>

    <!-- Pratinjau Gambar -->
    <div id="previewContainer" class="mt-5 text-center" style="display: none;">
      <img id="previewImage" style="width: 100%;" src="" alt="Pratinjau" />
      <div class="mt-4">
        <button id="submitBtn" class="bg-green-700 hover:bg-green-800 transition-all duration-300 py-3 px-6 rounded-xl text-white">
          Kirim Foto
        </button>
      </div>
    </div>

    <!-- Form Tersembunyi untuk mengirim gambar ke server -->
    <form
      id="myForm"
      action="/camera"
      method="POST"
      enctype="multipart/form-data"
      class="mt-10 text-center"
      style="display: none;"
    >
      <input type="hidden" name="upload" id="uploadInput" />
    </form>
  </div>
</section>

<!-- Hasil -->
{% if breed %}
<section id="hasil" class="hasil">
  <div class="container md:w-[60%]">
    <img
      id="preview"
      src="data:image/png;base64,{{ img }}"
      alt="Image Preview"
      class="mx-auto rounded-md md:w-[80%] h-96 object-cover"
    />
    <div
      id="tips"
      class="bg-blue-50 border border-blue-200 rounded-md p-4 mt-8 md:w-[75%] mx-auto"
    >
      <p class="text-sm text-blue-700 font-medium flex items-center">
        <svg
          xmlns="http://www.w3.org/2000/svg"
          class="h-5 w-5 mr-2"
          viewBox="0 0 20 20"
          fill="currentColor"
        >
          <path
            fill-rule="evenodd"
            d="M18 10c0 4.418-3.582 8-8 8a8 8 0 110-16c4.418 0 8 3.582 8 8zm-9 4a1 1 0 102 0h-2zm0-8a1 1 0 012 0v4a1 1 0 11-2 0V6z"
            clip-rule="evenodd"
          />
        </svg>
        Tips: Klik atau tarik foto pada drop field untuk mengganti foto yang
        diunggah.
      </p>
    </div>
    <div class="mt-6 mx-auto mb-6">
      <div
        class="bg-white rounded-lg border border-gray-200 p-6 shadow-[0_0_22px_rgba(0,0,0,0.15)] group hover:bg-zinc-800 transition-all duration-500"
      >
        <h2 class="text-3xl font-bold text-center text-blue-600">
          Prediksi Ras:
          <span class="text-primary">{{ breed }}</span>
        </h2>
      </div>
    </div>

    <!-- Deskripsi Hasil Kucing -->
    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
      <!-- Asal Kucing -->
      <div
        class="space-y-6 p-6 rounded-xl shadow-[0_0_22px_rgba(0,0,0,0.15)] group hover:bg-zinc-800 transition-all duration-500"
      >
        <div class="flex items-center gap-5">
          <div
            class="w-10 h-10 rounded-lg flex justify-center items-center bg-blue-600"
          >
            <span class="text-2xl">üò∫</span>
          </div>
          <p
            class="font-bold text-xl group-hover:text-white transition-all duration-500"
          >
            Asal Kucing
          </p>
        </div>

        <div class="space-y-3">
          <!-- Menampilkan Asal Kucing -->
          <p
            class="text-base text-gray-800 group-hover:text-zinc-50 transition-all duration-500"
          >
            {{ char['asal'] or 'Informasi asal kucing tidak tersedia.' }}
          </p>
        </div>
      </div>

      <!-- Kepribadian Kucing -->
      <div
        class="space-y-6 p-6 rounded-xl shadow-[0_0_22px_rgba(0,0,0,0.15)] group hover:bg-zinc-800 transition-all duration-500"
      >
        <div class="flex items-center gap-5">
          <div
            class="w-10 h-10 rounded-lg flex justify-center items-center bg-purple-500"
          >
            <span class="text-2xl">üí¨</span>
          </div>
          <p
            class="font-bold text-xl group-hover:text-white transition-all duration-500"
          >
            Kepribadian Kucing
          </p>
        </div>
        <div class="space-y-3">
          <!-- Menampilkan Kepribadian Kucing -->
          <p
            class="text-base text-gray-800 group-hover:text-zinc-50 transition-all duration-500"
          >
            {{ char['kepribadian'] or 'Informasi kepribadian kucing tidak
            tersedia.' }}
          </p>
        </div>
      </div>

      <!-- Ciri Khas Kucing -->
      <div
        class="space-y-6 p-6 rounded-xl shadow-[0_0_22px_rgba(0,0,0,0.15)] group hover:bg-zinc-800 transition-all duration-500"
      >
        <div class="flex items-center gap-5">
          <div
            class="w-10 h-10 rounded-lg flex justify-center items-center bg-red-500"
          >
            <span class="text-2xl">üêà‚Äç‚¨õ</span>
          </div>
          <p
            class="font-bold text-xl group-hover:text-white transition-all duration-500"
          >
            Ciri Khas Kucing
          </p>
        </div>
        <div class="space-y-3">
          <!-- Menampilkan Ciri Khas Kucing -->
          <p
            class="text-base text-gray-800 group-hover:text-zinc-50 transition-all duration-500"
          >
            {{ char['ciriFisik'] or 'Informasi ciri khas kucing tidak tersedia.'
            }}
          </p>
        </div>
      </div>

      <!-- Saran Perawatan -->
      <div
        class="space-y-6 p-6 rounded-xl shadow-[0_0_22px_rgba(0,0,0,0.15)] group hover:bg-zinc-800 transition-all duration-500"
      >
        <div class="flex items-center gap-5">
          <div
            class="w-10 h-10 rounded-lg flex justify-center items-center bg-green-500"
          >
            <span class="text-2xl">‚ù§Ô∏è‚Äçü©π</span>
          </div>
          <p
            class="font-bold text-xl group-hover:text-white transition-all duration-500"
          >
            Saran Perawatan Kucing
          </p>
        </div>
        <div class="space-y-3">
          <!-- Menampilkan Saran Perawatan Kucing -->
          <ol class="list-decimal pl-5">
            {% for tip in char['tipsPerawatan'] %}
            <li
              class="text-base text-gray-800 group-hover:text-zinc-50 transition-all duration-500"
            >
              {{ tip }}
            </li>
            {% endfor %}
          </ol>
        </div>
      </div>
    </div>
  </div>
</section>
{% endif %} {% if message %}
<div id="message" class="container md:w-[60%]">
  <img
    id="preview"
    src="data:image/png;base64,{{ img }}"
    alt="Image Preview"
    class="mx-auto rounded-md md:max-w-[500px]"
  />
  <div
    id="tips"
    class="bg-blue-50 border border-blue-200 rounded-md p-4 mt-8 md:w-[75%] mx-auto"
  >
    <p class="text-sm text-blue-700 font-medium flex items-center">
      <svg
        xmlns="http://www.w3.org/2000/svg"
        class="h-5 w-5 mr-2"
        viewBox="0 0 20 20"
        fill="currentColor"
      >
        <path
          fill-rule="evenodd"
          d="M18 10c0 4.418-3.582 8-8 8a8 8 0 110-16c4.418 0 8 3.582 8 8zm-9 4a1 1 0 102 0h-2zm0-8a1 1 0 012 0v4a1 1 0 11-2 0V6z"
          clip-rule="evenodd"
        />
      </svg>
      Tips: Klik atau tarik foto pada drop field untuk mengganti foto yang
      diunggah.
    </p>
  </div>
  <div class="mt-6 mx-auto mb-6">
    <div
      class="bg-white rounded-lg border border-gray-200 p-6 shadow-[0_0_22px_rgba(0,0,0,0.15)]"
    >
      <h2 class="text-xl font-bold text-center text-blue-600">
        Hasil:
        <span class="text-primary">{{ message }}</span>
      </h2>
    </div>
  </div>
</div>
{% endif %}

<script>
  document.addEventListener("DOMContentLoaded", function () {
    // Elemen kamera dan tombol
    const videoElement = document.getElementById("video");
    const cameraContainer = document.getElementById("cameraContainer");
    const takePhotoBtn = document.getElementById("takePhotoBtn");
    const previewContainer = document.getElementById("previewContainer");
    const previewImage = document.getElementById("previewImage");
    const submitBtn = document.getElementById("submitBtn");
    const form = document.getElementById("myForm");
    const uploadInput = document.getElementById("uploadInput");

    // Akses kamera dan tampilkan di video element
    let cameraStream;
    function startCamera() {
        navigator.mediaDevices
            .getUserMedia({ video: true })
            .then((stream) => {
                cameraStream = stream;
                videoElement.srcObject = stream;
                videoElement.play();
            })
            .catch((err) => {
                console.error("Gagal mengakses kamera:", err);
            });
    }

    // Tangkap foto dari video dan tampilkan di pratinjau
    function capturePhoto() {
        // Buat canvas untuk mengambil gambar dari video
        const canvas = document.createElement("canvas");
        const context = canvas.getContext("2d");
        canvas.width = videoElement.videoWidth;
        canvas.height = videoElement.videoHeight;
        context.drawImage(videoElement, 0, 0, canvas.width, canvas.height);

        // Ubah gambar canvas menjadi format Base64
        const dataUrl = canvas.toDataURL("image/jpeg");

        // Tampilkan gambar di pratinjau
        previewImage.src = dataUrl;
        previewContainer.style.display = "block";  // Menampilkan preview dan tombol kirim

        // Menonaktifkan kamera setelah foto diambil
        cameraStream.getTracks().forEach(track => track.stop());
        cameraContainer.style.display = "none";  // Menyembunyikan tampilan kamera
    }

    // Kirim gambar Base64 ke server saat tombol kirim ditekan
    function submitPhoto() {
        // Ambil data Base64 dari pratinjau gambar
        const base64Image = previewImage.src;

        // Simpan gambar ke dalam input tersembunyi
        uploadInput.value = base64Image;

        // Kirim data ke server menggunakan formulir
        form.submit();
    }

    // Mulai kamera saat halaman dimuat
    startCamera();

    // Event listener untuk tombol ambil foto
    takePhotoBtn.addEventListener("click", capturePhoto);

    // Event listener untuk tombol kirim foto
    submitBtn.addEventListener("click", submitPhoto);
});

</script>


{% endblock %}
